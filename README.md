# AOI CSV-Insert-Database

โปรเจกต์นี้ใช้ **Bun Version 1.2.20**

โปรเจกต์นี้ทำหน้าที่หลักในการดึงไฟล์ข้อมูล `.csv` ที่มาจากเครื่อง AOI จากโฟลเดอร์ที่กำหนดใน Shared Drive โดยอัตโนมัติ จากนั้นจะนำข้อมูลภายในไฟล์เหล่านั้นไป `Insert` หรือบันทึกลงในฐานข้อมูล และสุดท้ายจะย้ายไฟล์ `.csv` ที่ดำเนินการเสร็จแล้วไปเก็บไว้ในโฟลเดอร์สำหรับเก็บไฟล์เก่า (archive)

-----

### **การติดตั้งและรันโปรเจกต์**

1.  **ติดตั้ง Dependencies:**
    ```
    bun install
    ```
2.  **รันโดยใช้ PM2:**
    ```
    pm2 start src/index.ts --name <ชื่อโปรเจกต์> --interpreter bun
    ```

-----

### **ขั้นตอนการตั้งค่า**

1.  รันคำสั่ง `bun install`
2.  สร้างไฟล์ `.env` และทำการตั้งค่าตามไฟล์ `.env.example`
3.  ตั้งค่า `PATH` ของไฟล์ใน Shared Drive ใน `.env` โดยให้มีโครงสร้างตามตัวอย่างด้านล่าง

### **โครงสร้าง Shared Drive**

```
AOI/
├── csv-archive/         # โฟลเดอร์หลักสำหรับเก็บไฟล์ archive หลังจาก insert เสร็จ
│   └── AOI 001-006/ 	  # โฟลเดอร์ย่อยสำหรับแยกแต่ละเครื่อง AOI (มีตามจำนวนเครื่อง)
│
├── csv-input/           # โฟลเดอร์หลักสำหรับไฟล์ input จากเครื่อง AOI
│   └── AOI 001-006/     # โฟลเดอร์ย่อยสำหรับแยกแต่ละเครื่อง AOI (มีตามจำนวนเครื่อง)
```

**หมายเหตุ:** ชื่อโฟลเดอร์ย่อย `AOI 001-006` สามารถเปลี่ยนได้ แต่สำหรับเครื่อง AOI 001 หากทำการแก้ไขชื่อโฟลเดอร์จาก `AOI 001` เป็นชื่ออื่น ต้องทำการแก้ไข `AOI001_MACHINE_FOLDER="AOI001"` ในไฟล์ `.env` ให้ตรงกันด้วย

-----

### **โครงสร้างโปรเจกต์**

```
machine-performance-api/
├── .env.example            # ไฟล์ตัวอย่างการตั้งค่า config
├── .gitignore              # ไฟล์บอก Git ว่าไฟล์ไหนไม่ต้อง Track
├── package.json            # ข้อมูลโปรเจกต์และ Dependencies
├── tsconfig.json           # การตั้งค่า TypeScript Compiler
└── src/                    # โฟลเดอร์หลักของ Source Code
    ├── services/           # โฟลเดอร์เก็บ Service ต่างๆ
    │   └── csv.service.ts  # ไฟล์สำหรับ Logic ในการดึงข้อมูล CSV, Insert ลง Database และย้ายไฟล์
    │
    ├── config/             # โฟลเดอร์เก็บการตั้งค่า
    │   ├── index.ts        # ไฟล์สำหรับจัดการตัวแปรสภาพแวดล้อม (.env)
    │   └── db.config.ts    # ไฟล์สำหรับจัดการการเชื่อมต่อฐานข้อมูล MS SQL Server
    │
    └── index.ts            # จุดเริ่มต้นของ API
                            # ทำหน้าที่ควบคุมการทำงานหลักทั้งหมด จะทำการเช็คและสั่งให้ดึง CSV File จาก Shared Drive มาทุก 1 ชั่วโมง
```
